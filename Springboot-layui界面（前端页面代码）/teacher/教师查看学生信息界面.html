<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ä¸»ç•Œé¢</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="../layui/css/layui.css" rel="stylesheet">
</head>
<body>

<div style="padding: 16px;" id="tadiv"> 
  <table class="layui-hide" id="test" lay-filter="test"></table>
</div>

<script type="text/html" id="toolbarDemo">
    <div class="layui-form-item">
      <div class="layui-inline">
        <form id="addform" class="layui-form" lay-filter="byselect">
          <div class="layui-input-inline" style="width: 15%;">
              <input type="tel" name="stuId" placeholder="å­¦å·" class="layui-input">
          </div>
          <div class="layui-input-inline" style="width: 15%;">
              <input type="tel" name="name" placeholder="å§“å" class="layui-input">
          </div>
          <div class="layui-input-inline" style="width: 15%;">
            <input type="tel" name="sex" placeholder="æ€§åˆ«" class="layui-input">
          </div>
          <div class="layui-input-inline" style="width: 15%;">
          <input type="tel" name="clazz" placeholder="ç­çº§" class="layui-input">
        </form>
      </div>
        <button class="layui-btn layui-btn-sm" lay-event="search" style="height: 37px; width: 65px; margin-left: 5px;">æœç´¢</button>
    </div>
    </div>
    <button class="layui-btn layui-btn-sm" lay-event="getCheckData">è·å–é€‰ä¸­è¡Œæ•°æ®</button>
    <button class="layui-btn layui-btn-sm" lay-event="getData">è·å–å½“å‰é¡µæ•°æ®</button>
  </div>
</script>
<script type="text/html" id="barDemo">
  <div class="layui-clear-space">
    <a class="layui-btn layui-btn-xs" lay-event="edit" style="background-color: rgb(219, 94, 115);">ç¼–è¾‘</a>
    <a class="layui-btn layui-btn-xs" lay-event="more">åˆ é™¤</a>
  </div>
</script>  
<script src="../layui/layui.js"></script>
<script>
  window.addEventListener('message', function (msg) {
    console.log(msg.data);
})

layui.use(['table', 'dropdown'], function(){

  var url = location.href

  var table = layui.table;
  var dropdown = layui.dropdown;
  
  let $ = layui.$
  let tdata
  
  $.ajax({
    async:false,
    url: 'http://localhost:8080/teacher/selectStuByTeacherId',
    method: 'get',
    success: function(res){
      tdata = res.data
    }
  })


  // åˆ›å»ºæ¸²æŸ“å®ä¾‹
  table.render({
    elem: '#test',
    //url: 'http://localhost:8080/data', // æ­¤å¤„ä¸ºé™æ€æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€æ¢æˆçœŸå®æ¥å£
    data:tdata,

    toolbar: '#toolbarDemo',
    height:"500px",
    css: [ // é‡è®¾å½“å‰è¡¨æ ¼æ ·å¼
      '.layui-table-tool-temp{padding-right: 145px;}'
    ].join(''),
    cellMinWidth: 80,
    totalRow: true, // å¼€å¯åˆè®¡è¡Œ
    page: true,
    limits: ['10', '20', '30'],
    cols: [[
      {type: 'checkbox', fixed: 'left'},
      // {field:'id', fixed: 'left', width:80, title: 'ID', sort: true, totalRow: 'åˆè®¡ï¼š'},
      {field:'id', title: 'ç¼–å·',sort:true},
      {field:'stuId', title:'å­¦å·' },
      {field:'name', title: 'å§“å'},
      {field:'head', title: 'å¤´åƒ',css: '.layui-table img{max-width: 60px;}',
      templet:function(d){return '<img src=../imgs/' + d.head + ' style:"width:100px,height:60px">'}
      },
      // {field:'experience', width: 100, title: 'ç§¯åˆ†', sort: true, totalRow: '{{= d.TOTAL_NUMS }} ğŸ˜Š'}, 
      {field:'sex', title:'æ€§åˆ«', sort:true},
      {field:'phone', title:'æ‰‹æœºå·'},
      {field:'clazz.name', title:'ç­çº§',templet:function(d){
        if(d.clazz != null){
          return '<lable>'+d.clazz.name+'</lable>'
        }
      }},
      {fixed: 'right', title:'æ“ä½œ', width: 134, minWidth: 125, toolbar: '#barDemo'}
    ]],
    done: function(){
    },
    error: function(res, msg){
      console.log(res, msg)
    }
  });
  
  // å·¥å…·æ äº‹ä»¶
  table.on('toolbar(test)', function(obj){
    var id = obj.config.id;
    var checkStatus = table.checkStatus(id);
    var othis = lay(this);
    switch(obj.event){
      case 'getCheckData':
        var data1 = checkStatus.data;
        layer.alert(layui.util.escape(JSON.stringify(data1)));
      break;
      case 'getData':
        var getData = table.getData(id);
        layer.alert(layui.util.escape(JSON.stringify(getData)));
      break;

      case 'search':

        let form = layui.form;
        let formdata = form.val('byselect');
        //è¿›è¡Œç¼–ç ï¼Œé˜²æ­¢è¯·æ±‚ä¸­æ–‡ä¹±ç 
        formdata.name = encodeURI(formdata.name);
        formdata.sex = encodeURI(formdata.sex);
        formdata.clazz = encodeURI(formdata.clazz);

        $.ajax({
          url: 'http://localhost:8080/student/byQuery',
          method: 'get',
          data: formdata,
          success: function(res){
            //è¡¨æ ¼é‡è½½
            table.reload('test',{
              data:res.data
            })
          }
        })
      break;
      case 'LAYTABLE_TIPS':
        layer.alert('è‡ªå®šä¹‰å·¥å…·æ å›¾æ ‡æŒ‰é’®');
      break;
    };
  });
  
  // è§¦å‘å•å…ƒæ ¼å·¥å…·äº‹ä»¶
  table.on('tool(test)', function(obj){ // åŒå‡» toolDouble
    var data = obj.data; // è·å¾—å½“å‰è¡Œæ•°æ®
    
    if(obj.event === 'edit'){
      layer.open({
        title: 'ç¼–è¾‘ - id:'+ data.id,
        type: 2,
        area: ['60%','60%'],
        content: '../admin/æ›´æ”¹ä¿¡æ¯é¡µé¢/æ›´æ”¹å­¦ç”Ÿä¿¡æ¯.html',
        success: function(layero, index){
          //å¾—åˆ°iframeé¡µçš„çª—å£å¯¹è±¡
          var iframeWin = window[layero.find('iframe')[0]['name']]; 
      
          // è·å– iframe ä¸­ body å…ƒç´ çš„ jQuery å¯¹è±¡
          var body = layer.getChildFrame('body', index);
          // ç»™ iframe é¡µä¸­çš„æŸä¸ªè¾“å…¥æ¡†èµ‹å€¼
          body.find('#stuname').val(data.name);
          body.find('#stuId').val(data.stuId);
          body.find('#stuphone').val(data.phone);
          body.find('input[name=sex][value=ç”·]').attr("checked",data.sex=='ç”·' ? true : false);
		      body.find('input[name=sex][value=å¥³]').attr("checked",data.sex=='å¥³' ? true : false);
          body.find('#stuclazz').val(data.clazz.name);
          if(data.head != null){
            body.find('.stuhead')[0].src = "../../imgs/" + data.head
          }
          //éšè—åŸŸ
          body.find('#head').val(data.head);
          body.find('#id').val(data.id);

          // è§¦å‘æ¸²æŸ“
          iframeWin.layui.form.render();
        },
        end: function(){
          //å‘é€ajaxè¯·æ±‚ åˆ é™¤åŸå¤´åƒæ–‡ä»¶ åˆ·æ–°è¡¨æ ¼
          $.ajax({
            url: 'http://localhost:8080/student',
            method: 'get',
            data:data,
            success: function(res){
              table.reload('test',{
                data:res.data
              })
            }
          })
        }
    });
    // è¡¨å•èµ‹å€¼
    } else if(obj.event === 'more'){
      layer.confirm('çœŸçš„åˆ é™¤è¡Œ [id: '+ data.id +'] ä¹ˆ?', function(index){
        $.ajax({
          url:'http://localhost:8080/student/' + data.id,
          method:'delete',
          success: function(res){
            if(res.flag == true){
              obj.del();   // åˆ é™¤å¯¹åº”è¡Œï¼ˆtrï¼‰çš„DOMç»“æ„
              layer.close(index);
              layer.msg('åˆ é™¤æˆåŠŸ',{icon:1});
            }else{
              layer.msg('åˆ é™¤å¤±è´¥',{icon:2});
            }
          }
        })
      });
    }
  });
 
  // è§¦å‘è¡¨æ ¼å¤é€‰æ¡†é€‰æ‹©
  table.on('checkbox(test)', function(obj){
    console.log(obj)
  });
 
  // è§¦å‘è¡¨æ ¼å•é€‰æ¡†é€‰æ‹©
  table.on('radio(test)', function(obj){
    console.log(obj)
  });
  
  // è¡Œå•å‡»äº‹ä»¶
  table.on('row(test)', function(obj){
    //console.log(obj);
    //layer.closeAll('tips');
  });
});
</script>
</body>
</html>